generator client {
    provider        = "prisma-client-js"
    previewFeatures = ["referentialIntegrity"]
}

datasource db {
    provider             = "mysql"
    url                  = env("DATABASE_URL")
    referentialIntegrity = "prisma"
}

model Localidad {
    id        Int        @id @default(autoincrement())
    nombre    String
    latitud   Float
    longitud  Float
    comercios Comercio[]

    deletedOn DateTime?
    createdOn DateTime @default(now())
}

model CategoriaComercio {
    id          Int        @id @default(autoincrement())
    nombre      String
    descripcion String?
    comercios   Comercio[]

    deletedOn DateTime?
    createdOn DateTime @default(now())
}

model Comercio {
    id          Int                 @id @default(autoincrement())
    nombre      String
    categorias  CategoriaComercio[]
    direccion   String
    localidad   Localidad?          @relation(fields: [localidadId], references: [id])
    localidadId Int?
    latitud     Float
    longitud    Float
    horario     String // este despues vuela, es para que no se rompa todo al migrar.
    horarios    Horario[]
    telefono    String
    imagenURL   String?             @db.Text

    // Redes
    facebookURL  String?
    instagramURL String?
    URL          String?

    productos           Producto[]
    estrellas           Int        @default(0)
    ratingPrecios       Int        @default(0)
    productosDiabeticos Boolean    @default(false)
    productosVeganos    Boolean    @default(false)
    validado            Boolean    @default(false)

    deletedOn DateTime?
    createdOn DateTime @default(now())
}

enum CategoriaProducto {
    Frescos
    Panificados
    Elaborados
    Envasados
    Bebidas
    Postres
    Snacks
}

model Producto {
    id          Int               @id @default(autoincrement())
    nombre      String
    descripcion String?
    categoria   CategoriaProducto
    precio      Int // en centavos
    rating      Int               @default(0)
    imagen      String?
    validado    Boolean           @default(false)

    comercioId Int
    comercio   Comercio @relation(fields: [comercioId], references: [id])

    deletedOn DateTime?
    createdOn DateTime @default(now())
}

enum DiaSemana {
    Lunes
    Martes
    Miercoles
    Jueves
    Viernes
    Sabado
    Domingo
}

model Horario {
    id         Int       @id @default(autoincrement())
    apertura   Int // en minutos desde las 00:00
    cierre     Int // en minutos desde las 00:00
    dia        DiaSemana
    comercioId Int
    comercio   Comercio  @relation(fields: [comercioId], references: [id])

    deletedOn DateTime?
    createdOn DateTime @default(now())
}
